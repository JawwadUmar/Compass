<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compass App</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 0;
            padding: 0;
            background-color: #f0f8ff;
        }
        #compass {
            margin: 20px auto;
            width: 200px;
            height: 200px;
            border: 5px solid #000;
            border-radius: 50%;
            position: relative;
            background: linear-gradient(to bottom, #fff, #e0e0e0);
        }
        #compass::before {
            content: "";
            position: absolute;
            top: 50%;
            left: 50%;
            width: 10px;
            height: 10px;
            background-color: red;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            z-index: 2;
        }
        #arrow {
            position: absolute;
            top: 10%;
            left: 50%;
            width: 10px;
            height: 90px;
            background: red;
            transform-origin: bottom center;
            transform: translateX(-50%);
            z-index: 1;
        }
        #heading {
            margin-top: 20px;
            font-size: 1.5em;
        }
    </style>
</head>
<body>
    <h1>Compass App</h1>
    <div id="compass">
        <div id="arrow"></div>
    </div>
    <p id="heading">Heading: 0°</p>

    <script>
        let targetLat, targetLon;
    
        function calculateBearing(lat1, lon1, lat2, lon2) {
            const toRadians = (deg) => (deg * Math.PI) / 180;
            const toDegrees = (rad) => (rad * 180) / Math.PI;
    
            const dLon = toRadians(lon2 - lon1);
            const y = Math.sin(dLon) * Math.cos(toRadians(lat2));
            const x =
                Math.cos(toRadians(lat1)) * Math.sin(toRadians(lat2)) -
                Math.sin(toRadians(lat1)) * Math.cos(toRadians(lat2)) * Math.cos(dLon);
    
            let bearing = toDegrees(Math.atan2(y, x));
            return (bearing + 360) % 360; // Normalize to 0-360
        }
    
        function startCompass() {
            targetLat = parseFloat(document.getElementById("latitude").value);
            targetLon = parseFloat(document.getElementById("longitude").value);
    
            if (isNaN(targetLat) || isNaN(targetLon)) {
                alert("Please enter valid latitude and longitude!");
                return;
            }
    
            if (window.DeviceOrientationEvent) {
                // Notify user to calibrate sensors
                alert("Please rotate your device in a figure-8 motion to calibrate the compass.");
    
                window.addEventListener("deviceorientation", (event) => {
                    let heading;
    
                    // Use webkitCompassHeading if available (True North)
                    if (event.webkitCompassHeading !== undefined) {
                        heading = event.webkitCompassHeading; // True North
                    } else if (event.alpha !== null) {
                        heading = event.alpha; // Fallback to alpha
                    } else {
                        document.getElementById("status").textContent = "Unable to get heading.";
                        return;
                    }
    
                    document.getElementById("heading").textContent = heading.toFixed(2) + "°";
    
                    // Use the user's current location
                    navigator.geolocation.getCurrentPosition(
                        (position) => {
                            const currentLat = position.coords.latitude;
                            const currentLon = position.coords.longitude;
    
                            const bearing = calculateBearing(currentLat, currentLon, targetLat, targetLon);
                            document.getElementById("bearing").textContent = bearing.toFixed(2) + "°";
    
                            const difference = Math.abs(heading - bearing);
                            if (difference < 15 || difference > 345) {
                                document.getElementById("status").textContent = "You're facing the target!";
                                document.getElementById("status").style.color = "green";
                            } else {
                                document.getElementById("status").textContent = "Adjust your direction.";
                                document.getElementById("status").style.color = "red";
                            }
                        },
                        (error) => {
                            alert("Error getting location: " + error.message);
                        },
                        { enableHighAccuracy: true }
                    );
                });
            } else {
                alert("Device Orientation is not supported on this device.");
            }
        }
    </script>
    
</body>
</html>
